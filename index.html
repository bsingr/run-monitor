<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <title>Half Marathon Training Monitor</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/plottable.js/2.2.0/plottable.css" media="screen">
    <link href="https://fonts.googleapis.com/css?family=Catamaran" rel="stylesheet">
    <link rel="stylesheet" href="assets/layout.css" media="screen">
    <script src="https://npmcdn.com/contentful@3.5.0/browser-dist/contentful.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/d3/3.5.5/d3.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/plottable.js/2.2.0/plottable.js"></script>
    <script src="assets/render.js"></script>
  </head>
  <body>

  <main id="runs"></main>

  <script>
    var config = {
      contentful: {
        space: 'p327c0m8jkw0',
        accessToken: '2edae343b5279c84248ad8be38f9ce5f0e3e6513483d75d40bcb9c51f1afcaeb'
      },
      target: {
        distance: 21.1,
        pace: 10.6
      }
    }

    var runsContainer = document.getElementById('runs')

    var calculateIntensity = function (distance, pace) {
      return distance * Math.pow(pace, 3) / 1000
    }

    contentful.createClient(config.contentful).getEntries({
      content_type: 'run',
      order: '-fields.date' // reverse order
    }).then(function (entries) {
      entries.items.map(function (item) {
        const run = item.fields
        run.pace = run.distance / run.time * 60
        run.intensity = calculateIntensity(run.distance, run.pace) / calculateIntensity(config.target.distance, config.target.pace)
        return run
      }).forEach(function (run) {
        render.distance(
          runsContainer,
          run.distance,
          config.target.distance
        )
        render.intensity(
          runsContainer,
          run.intensity
        )
      })
    })
  </script>
  </body>
</html>
